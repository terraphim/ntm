#!/bin/bash
# Fake ubs (Ultimate Bug Scanner) tool for testing
# Supports MODE environment variable: normal (default), timeout, error

MODE="${FAKE_TOOL_MODE:-normal}"

case "$MODE" in
    timeout)
        exec sleep 3600
        ;;
    error)
        echo "ubs: simulated error" >&2
        exit 1
        ;;
esac

# Normal mode - check arguments
case "$1" in
    --version|-v|version)
        echo "ubs 0.4.2"
        exit 0
        ;;
    scan)
        if [[ "$*" == *"--json"* ]]; then
            echo '{"findings": [{"id": "UBS001", "severity": "medium", "category": "maintainability", "file": "test.go", "line": 42, "message": "Consider extracting this into a function", "suggestion": "Extract method"}], "total_count": 1, "critical": 0, "high": 0, "medium": 1, "low": 0, "info": 0, "scan_time": "1.2s"}'
        else
            echo "Found 1 issue (0 critical, 0 high, 1 medium, 0 low)"
            echo "  test.go:42 [medium] Consider extracting this into a function"
        fi
        exit 0
        ;;
    doctor)
        echo "ubs doctor: all checks passed"
        echo "  - Configuration: OK"
        echo "  - Rules database: OK"
        echo "  - Output format: OK"
        exit 0
        ;;
    help|--help|-h|*)
        echo "ubs - Ultimate Bug Scanner (fake for testing)"
        echo "Usage: ubs <command>"
        echo "  version     Show version"
        echo "  scan        Scan code for bugs and issues"
        echo "  doctor      Run diagnostics"
        echo "  --json      Output as JSON"
        exit 0
        ;;
esac
